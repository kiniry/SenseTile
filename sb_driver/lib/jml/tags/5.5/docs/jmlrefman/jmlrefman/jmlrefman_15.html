<HTML>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created on January, 9  2008 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<TITLE>JML Reference Manual: Specification for Subtypes</TITLE>

<META NAME="description" CONTENT="JML Reference Manual: Specification for Subtypes">
<META NAME="keywords" CONTENT="JML Reference Manual: Specification for Subtypes">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC190"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_14.html#SEC180"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_16.html#SEC193"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_28.html#SEC247">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>

<HR SIZE=2>
<H1> 15. Specification for Subtypes </H1>
<!--docid::SEC190::-->
<P>

<A NAME="IDX2796"></A>
<A NAME="IDX2797"></A>
<A NAME="IDX2798"></A>
This chapter describes how JML specifies a type so that one can
program subtypes from the specification, without the need to see the
code of the supertypes that have been specified.
</P><P>

<A NAME="IDX2799"></A>
<A NAME="IDX2800"></A>
<A NAME="IDX2801"></A>
The problem of specifying enough about superclasses has been discussed
by Kiczales and Lamping <A HREF="jmlrefman_27.html#BIB45">[Kiczales-Lamping92]</A>
and by Steyaert, et al. <A HREF="jmlrefman_27.html#BIB102">[Steyaert-etal96]</A>.  This problem is difficult
because of the many ways that subclasses can depend on coding details
of a superclass.  For example, a subclass can depend on the calling
pattern among a superclass's method and the fields that a superclass
can access <A HREF="jmlrefman_27.html#BIB45">[Kiczales-Lamping92]</A> <A HREF="jmlrefman_27.html#BIB102">[Steyaert-etal96]</A>.
</P><P>

<A NAME="IDX2802"></A>
<A NAME="IDX2803"></A>
JML builds on the work of Ruby and Leavens to solve this problem
<A HREF="jmlrefman_27.html#BIB97">[Ruby-Leavens00]</A> <A HREF="jmlrefman_27.html#BIB98">[Ruby06]</A>, which builds on the earlier works described above.
The idea is to write specifications for subclasses in three parts.
The first is the usual, public specification, which is primarily for
clients but also useful to subclasses, who need to know what public
interface they must meet.  The second is a protected specification,
which specifies fields and methods that are usable by the subclass.
The third is the code contract.  The code contract has a different
syntax in JML than it did in <A HREF="jmlrefman_27.html#BIB97">[Ruby-Leavens00]</A>.
<A NAME="IDX2804"></A>
<A NAME="IDX2805"></A>
In the current JML
a <EM>code contract</EM>
is a heavyweight behavior specification case
(see section <A HREF="jmlrefman_9.html#SEC87">9.5 Heavyweight Specification Cases</A>)
or as a model program (see section <A HREF="jmlrefman_14.html#SEC180">14. Model Programs</A>)
that uses the keyword "<CODE>code</CODE>."
The <CODE>code</CODE> keyword is used just before one of the behavior
keywords or just before the keyword <CODE>model_program</CODE>.
</P><P>

<A NAME="IDX2806"></A>
<A NAME="IDX2807"></A>
While code contracts can be generated automatically by a tool, as
imagined by Ruby and Leavens <A HREF="jmlrefman_27.html#BIB97">[Ruby-Leavens00]</A> <A HREF="jmlrefman_27.html#BIB98">[Ruby06]</A>, they can also be
written by users directly.  This is sometimes useful for documenting
the implementation of a method. The code contract is intended to be
created automatically, by a tool (which does not, as of this writing, exist).
It has the following syntax.
</P><P>

In code contracts as described in the work of Ruby and Leavens,
the main clauses used are the <VAR>accessible-clause</VAR> and the
<VAR>callable-clause</VAR>. 
See section <A HREF="jmlrefman_9.html#SEC112">9.9.10 Accessible Clauses</A>, for the syntax and semantics of the
<VAR>accessible-clause</VAR>. 
See section <A HREF="jmlrefman_9.html#SEC113">9.9.11 Callable Clauses</A>, for the syntax and semantics of the
<VAR>callable-clause</VAR>. 
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="jmlrefman_15.html#SEC191">15.1 Method of Specifying for Subclasses</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="jmlrefman_15.html#SEC192">15.2 Code Contracts</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Method of Specifying for Subclasses"></A>
<HR SIZE="6">
<A NAME="SEC191"></A>
<H2> 15.1 Method of Specifying for Subclasses </H2>
<!--docid::SEC191::-->
<P>

[[[This should be a synopsis of Clyde Ruby's dissertation, with an example.]]]
</P><P>

<A NAME="Code Contracts"></A>
<HR SIZE="6">
<A NAME="SEC192"></A>
<H2> 15.2 Code Contracts </H2>
<!--docid::SEC192::-->
<P>

<A NAME="IDX2808"></A>
<A NAME="IDX2809"></A>
This section discusses the semantics of 
"code contracts," which are specification cases that use the
"<CODE>code</CODE>" keyword.
(See section <A HREF="jmlrefman_9.html#SEC88">9.6 Behavior Specification Cases</A>, for the detailed syntax of such
specification cases.)
</P><P>

<A NAME="IDX2810"></A>
<A NAME="IDX2811"></A>
<A NAME="IDX2812"></A>
This feature was inspired by "does" clause of the Alloy Annotation Language
<A HREF="jmlrefman_27.html#BIB41">[Khurshid-Marinov-Jackson02]</A>.
</P><P>

The modifier <CODE>code</CODE> may not be used on an abstract method.
It follows that the <CODE>code</CODE> modifier cannot be used to document
normal Java methods in interfaces.
(In an interface,
<CODE>code</CODE> could only be used in the specification of a model method that
has a body.)
</P><P>

Tools for JML should warn the user
if <CODE>code</CODE> is used in a specification case for a constructor, or
for a final, static, or private method.  It does no harm there, but is
not needed. 
</P><P>

The meaning of the <CODE>code</CODE> modifier is just that specification cases or
model programs containing them are not inherited.  That is, whenever
the method is overridden, it does not inherit code contracts from its
supertypes. 
</P><P>

<A NAME="IDX2813"></A>
<A NAME="IDX2814"></A>
In verification of a method call, you can use all non-code
specification cases, that are visible at a call site, for the
statically-determined method being called.  Such specifications are
inherited by each subtype's method overrides to preserve behavioral
subtyping <A HREF="jmlrefman_27.html#BIB22">[Dhara-Leavens96]</A> <A HREF="jmlrefman_27.html#BIB57">[Leavens-Naumann06]</A> <A HREF="jmlrefman_27.html#BIB65">[Leavens06b]</A>.
</P><P>

In verification of a method call, you can use a code specification
case for a method <I>m</I> given in a class <I>C</I> only if you can prove that the
method being called is method <I>m</I> in class <I>C</I>.  This applies in
particular to super calls, which is the main use for such code
contracts.  (It would also apply to calls to final methods,
calls to methods in final classes, and calls to private or static
methods.)
</P><P>

<A NAME="Refinement"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_15.html#SEC190"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_16.html#SEC193"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_28.html#SEC247">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="jmlrefman_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated
by <I>Gary Leavens</I> on <I>January, 9  2008</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
