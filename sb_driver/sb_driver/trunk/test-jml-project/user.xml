<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<project basedir="." default="generate_jml_test_source" name="test-jml">

  <property name="main-project.location" value="../main-project" />
  <property name="spec-project.location" value="../spec-project" />
  <property name="test.jml.project" value="." />

  <path id="jml-libraries.classpath">
    <pathelement location="${spec-project.location}/lib/jml/jml-release.jar" />
    <pathelement location="${spec-project.location}/lib/jml/specs" />
  </path>

  <path id="main-project.classpath">
    <pathelement location="${main-project.location}/bin" />
    <pathelement location="${main-project.location}/lib/d2xxj/ftd2xxj.jar" />
    <pathelement location="${main-project.location}/lib/d2xxj/javax.util.property.jar" />
  </path>

  <path id="jml.classpath">
    <path refid="jml-libraries.classpath" />
    <path refid="main-project.classpath" />
  </path>
  <property name="jml.classpath" refid="jml.classpath" />

  <property name="jml.src" value="${spec-project.location}/src" />
  <property name="jml.junit.src" value="${test.jml.project}/test.generated" />

  <property name="jml.src.compile" value="ie.ucd.sensetile"/>
  
  <target name="clean">
    <delete dir="${jml.junit.src}" />
  </target>
  
  <target name="init">
    <mkdir dir="${jml.junit.src}" />
  </target>
  
  <target name="generate_jml_test_source" depends="init">
    <property name="jml.debug" value="--debug" />
    <property name="jml.warning" value="--warning" />
    <property name="jml.recursive" value="--recursive" />
    <property name="jml.source_code" value="--source 1.4" />
    <!-- 
    <property name="jml.test.generator" value="- - useGenerator" /> 
    -->
    <property name="jml.test.generator" value="" />
    <property name="jml.test.generator.classname" value="--generatorClassName Generator" />
    <property name="jml.test.generator.packagename" value="--generatorPackageName ie.ucd.sensetile" />
    <java failonerror="true" fork="true" classname="org.jmlspecs.jmlunit.Main"> 
      <jvmarg value="-Xms64m" />
      <jvmarg value="-Xmx128m" />
      <classpath>
        <path refid="jml.classpath" />
      </classpath>
      <arg line="${jml.debug}" />
      <arg line="${jml.warning}" />
      <arg line="${jml.recursive}" />
      <arg line="${jml.source_code}" />
      <arg line="${jml.test.generator}" />
      <arg line="${jml.test.generator.classname}" />
      <arg line="${jml.test.generator.packagename}" />
      <arg line="--classpath ${jml.classpath}" />
      <arg line="--sourcepath ${jml.src}" />
      <arg line="--destination ${jml.junit.src}" />
      <arg line="${jml.src.compile}" />
    </java>
  </target>

</project>
